; ============================================
; Cimaise - Recommended PHP Performance Configuration
; ============================================
; Copy this to your php.ini or create a custom conf.d file
; Location examples:
; - Ubuntu/Debian: /etc/php/8.2/fpm/conf.d/99-cimaise-performance.ini
; - CentOS/RHEL: /etc/php.d/99-cimaise-performance.ini
; - Docker: Add to PHP-FPM config
; ============================================

; ===== OPCACHE SETTINGS (Code Caching) =====
; OPcache stores precompiled script bytecode in memory
; CRITICAL for performance - can improve speed by 3-5x

[opcache]
; Enable OPcache
opcache.enable=1
opcache.enable_cli=0

; Memory configuration
opcache.memory_consumption=256        ; 256MB for OPcache (increase if you have many plugins)
opcache.interned_strings_buffer=16   ; 16MB for interned strings
opcache.max_accelerated_files=10000  ; Max number of cached files

; Revalidation (for production, disable revalidation for max performance)
opcache.validate_timestamps=1        ; Set to 0 in production for max speed
opcache.revalidate_freq=60          ; Check for file changes every 60 seconds

; Optimization level
opcache.optimization_level=0x7FFEBFFF
opcache.enable_file_override=1

; Interned strings optimization
opcache.save_comments=1              ; Keep comments for Twig/annotations
opcache.fast_shutdown=1              ; Faster shutdown

; File cache (optional: persist cache between PHP restarts)
; opcache.file_cache=/var/cache/php/opcache
; opcache.file_cache_only=0

; JIT Compiler (PHP 8.0+)
; Significantly faster for CPU-intensive operations
opcache.jit=tracing                  ; or 'function' for less memory
opcache.jit_buffer_size=128M         ; 128MB for JIT compilation


; ===== APCU SETTINGS (Data Caching) =====
; APCu is a user-land cache for storing application data
; Used by QueryCache for caching database results

[apcu]
; Enable APCu
apc.enabled=1
apc.enable_cli=0

; Memory configuration
apc.shm_size=128M                    ; 128MB for APCu cache
apc.ttl=600                          ; Default TTL 10 minutes
apc.gc_ttl=3600                      ; Garbage collection after 1 hour
apc.entries_hint=4096                ; Expected number of cache entries

; Serialization (use faster serializer if available)
apc.serializer=php                   ; or 'igbinary' if installed


; ===== GENERAL PHP PERFORMANCE =====

[PHP]
; Memory limit
memory_limit=512M                    ; Increase if handling large uploads

; Realpath cache (faster file path resolution)
realpath_cache_size=4M               ; 4MB for path cache
realpath_cache_ttl=600               ; Cache paths for 10 minutes

; File uploads
upload_max_filesize=64M              ; Max upload size
post_max_size=64M                    ; Must be >= upload_max_filesize
max_file_uploads=50                  ; Allow multiple file uploads

; Script execution
max_execution_time=300               ; 5 minutes for image processing
max_input_time=300

; Session configuration (for better security and performance)
session.save_handler=files           ; or 'redis' for distributed setup
session.gc_probability=1
session.gc_divisor=100               ; 1% chance of GC
session.gc_maxlifetime=1440          ; 24 minutes

; Disable functions not needed (security)
; disable_functions=exec,passthru,shell_exec,system,proc_open,popen


; ===== PHP-FPM SPECIFIC (if using PHP-FPM) =====
; Edit in /etc/php/8.2/fpm/pool.d/www.conf

; Process manager configuration
; pm = dynamic
; pm.max_children = 50              ; Max number of child processes
; pm.start_servers = 5              ; Initial processes
; pm.min_spare_servers = 5          ; Minimum idle processes
; pm.max_spare_servers = 10         ; Maximum idle processes
; pm.max_requests = 500             ; Recycle after 500 requests


; ===== VERIFICATION =====
; After applying changes, restart PHP-FPM:
; - systemctl restart php8.2-fpm     (Ubuntu/Debian)
; - systemctl restart php-fpm        (CentOS/RHEL)
;
; Verify OPcache is enabled:
; - Create a file: <?php phpinfo(); ?>
; - Check "Zend OPcache" section
;
; Verify APCu is enabled:
; - Run: php -m | grep apcu
; - Or check phpinfo() for "apcu" section
