import"./home-gallery.js";import"./lenis-CfsBQfFC.js";var e;e=()=>{const e=document.getElementById("albums-carousel");if(!e)return;const t=e.parentElement,s=e.querySelectorAll(".album-carousel-item");if(!s.length)return;let a=0,n=0,r=!1,i=0,o=null;const l=()=>{const e=s[0],t=getComputedStyle(e);return e.offsetWidth+parseFloat(t.marginLeft)+parseFloat(t.marginRight)},c=l()*s.length,h=()=>{e.style.transform=`translate3d(${a}px, 0, 0)`},d=e=>e.type.includes("mouse")?e.clientX:e.touches[0].clientX,m=window.matchMedia&&window.matchMedia("(max-width: 767px)").matches,u=()=>{a-=.6,Math.abs(a)>=c&&(a=0),h(),o=requestAnimationFrame(u)};m||(o=requestAnimationFrame(u));const g=t=>{t.preventDefault(),t.stopPropagation(),r=!0,i=d(t),n=a,o&&(cancelAnimationFrame(o),o=null),e.classList.add("dragging"),document.body.style.userSelect="none"},p=e=>{if(!r)return;e.preventDefault(),e.stopPropagation();const t=d(e);a=n+(t-i),h()},f=()=>{const e=l()*s.length;Math.abs(a)>=e&&(a%=e),a>0&&(a=a%e-e)},v=()=>{r&&(r=!1,e.classList.remove("dragging"),document.body.style.userSelect="",f(),h(),m||setTimeout(()=>{o||(o=requestAnimationFrame(u))},1200))};e.addEventListener("mousedown",g),e.addEventListener("mousemove",p),e.addEventListener("mouseup",v),e.addEventListener("mouseleave",v),e.addEventListener("touchstart",g,{passive:!1}),e.addEventListener("touchmove",p,{passive:!1}),e.addEventListener("touchend",v),e.addEventListener("dragstart",e=>e.preventDefault()),e.addEventListener("selectstart",e=>e.preventDefault()),m||(t.addEventListener("mouseenter",()=>{o&&(cancelAnimationFrame(o),o=null)}),t.addEventListener("mouseleave",()=>{o||r||(o=requestAnimationFrame(u))}));const b=t.parentElement.querySelector(".albums-arrow-left"),w=t.parentElement.querySelector(".albums-arrow-right"),I=()=>1*l();b&&b.addEventListener("click",()=>{a+=I(),f(),h()}),w&&w.addEventListener("click",()=>{a-=I(),f(),h()})},"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e);class t{constructor(e={}){this.apiUrl=e.apiUrl||"/api/home/gallery",this.container=e.container,this.renderImage=e.renderImage,this.batchSize=e.batchSize||20,this.hasMore=!0,this.loading=!1,this.observer=null,this.cache=new Map,this.prefetchQueue=[],this.connectionSpeed=this._detectConnectionSpeed(),this.adaptiveBatchSize=this._calculateAdaptiveBatchSize(),this.prefetchInProgress=!1,this.shownImageIds=new Set((e.shownImageIds||[]).map(e=>parseInt(e,10)).filter(e=>!isNaN(e)&&e>0)),this.shownAlbumIds=new Set((e.shownAlbumIds||[]).map(e=>parseInt(e,10)).filter(e=>!isNaN(e)&&e>0))}_detectConnectionSpeed(){if("connection"in navigator){const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(e){const t=e.effectiveType;if("slow-2g"===t||"2g"===t)return"slow";if("3g"===t)return"medium";if("4g"===t)return"fast"}}return"medium"}_calculateAdaptiveBatchSize(){const e=this.batchSize;switch(this.connectionSpeed){case"slow":return Math.max(10,Math.floor(.5*e));case"fast":return Math.floor(1.5*e);default:return e}}_getCacheKey(e){return`${this.apiUrl}:${e}:${this.adaptiveBatchSize}`}async loadMore(){if(!this.loading&&this.hasMore){this.loading=!0;try{if(this.prefetchQueue.length>0){const e=this.prefetchQueue.shift();return this._processImageData(e),this.loading=!1,void this._prefetchNextBatch()}const e=await this._fetchBatch();e&&(this._processImageData(e),this._prefetchNextBatch())}catch(e){this.hasMore=!1}finally{this.loading=!1}}}async _fetchBatch(){const e=this._getCacheKey(this.shownImageIds.size);if(this.cache.has(e))return this.cache.get(e);let t,s;try{s=new AbortController,t=setTimeout(()=>s.abort(),1e4);const a=new URLSearchParams({exclude:Array.from(this.shownImageIds).join(","),excludeAlbums:Array.from(this.shownAlbumIds).join(","),limit:String(this.adaptiveBatchSize)}),n=await fetch(`${this.apiUrl}?${a}`,{signal:s.signal,priority:"high"});if(!n.ok)return this.hasMore=!1,null;const r=await n.json();return this.cache.size<5&&this.cache.set(e,r),r}catch(a){return a.name,this.hasMore=!1,null}finally{t&&clearTimeout(t)}}_processImageData(e){Array.isArray(e.images)&&e.images.forEach(e=>{const t=parseInt(e.id,10);isNaN(t)||t<=0||this.shownImageIds.has(t)||(this.renderImage&&this.renderImage(e),this.shownImageIds.add(t))}),Array.isArray(e.newAlbumIds)&&e.newAlbumIds.forEach(e=>{const t=parseInt(e,10);!isNaN(t)&&t>0&&this.shownAlbumIds.add(t)}),this.hasMore=Boolean(e.hasMore)}async _prefetchNextBatch(){if(!this.prefetchInProgress&&this.hasMore&&"slow"!==this.connectionSpeed){this.prefetchInProgress=!0;try{const e=async()=>{const e=await this._fetchBatch();e&&e.images&&e.images.length>0&&this.prefetchQueue.push(e),this.prefetchInProgress=!1};"requestIdleCallback"in window?requestIdleCallback(()=>e(),{timeout:2e3}):setTimeout(()=>e(),100)}catch(e){this.prefetchInProgress=!1}}}observe(e){e&&(this.observer&&this.observer.disconnect(),this.observer=new IntersectionObserver(e=>{e.some(e=>e.isIntersecting)&&this.hasMore&&!this.loading&&this.loadMore()},{rootMargin:"200px"}),this.observer.observe(e))}disconnect(){this.observer&&(this.observer.disconnect(),this.observer=null)}startBackgroundLoading(){requestAnimationFrame(()=>{this.loadMore()})}hasMoreImages(){return this.hasMore}isLoading(){return this.loading}getLoadedCount(){return this.shownImageIds.size}}!function(){function e(e,t,s){var a,n,r;const i=Number.parseInt(e.width,10),o=Number.parseInt(e.height,10),l=Number.isFinite(i)&&i>0?i:1600,c=Number.isFinite(o)&&o>0?o:1067,h=e=>e&&e.length?e.map(e=>{const s=e.split(" ");return`${s[0].startsWith("/")?t+s[0]:s[0]} ${s[1]||"1x"}`}).join(", "):"",d=h(null==(a=e.sources)?void 0:a.avif),m=h(null==(n=e.sources)?void 0:n.webp),u=h(null==(r=e.sources)?void 0:r.jpg),g=e.fallback_src||e.url,p=g.startsWith("/")?t+g:g,f=`${t}/album/${encodeURIComponent(e.album_slug||"")}`,v=e.alt||e.album_title||"",b=e.album_title||"",w=document.createElement("div");w.className=s?"home-cell-h":"home-cell";const I=document.createElement("div");I.className="home-item home-item--revealed loading group rounded-xl overflow-hidden shadow-sm relative transition-transform hover:scale-105 duration-300",I.style.aspectRatio=`${l} / ${c}`,I.dataset.imageId=String(parseInt(e.id,10)||0);const y=document.createElement("a");y.href=f,y.className="block w-full h-full relative z-10",y.title=b;const E=document.createElement("picture");E.className="block w-full h-full";const A=(e,t)=>{if(!t)return;const s=document.createElement("source");s.type=e,s.srcset=t,s.sizes="(min-width:1024px) 50vw, (min-width:640px) 70vw, 100vw",E.appendChild(s)};A("image/avif",d),A("image/webp",m),A("image/jpeg",u);const L=document.createElement("img");L.src=p,L.alt=v,L.width=l,L.height=c,L.loading="lazy",L.decoding="async",L.className="w-full h-full object-cover block",L.addEventListener("load",()=>{I.classList.remove("loading")}),L.addEventListener("error",()=>{I.classList.remove("loading")}),E.appendChild(L);const S=document.createElement("div");S.className="absolute inset-0 bg-black/70 text-white flex items-center justify-center transform translate-y-full group-hover:translate-y-0 transition-transform duration-300";const M=document.createElement("span");return M.className="px-4 text-base md:text-lg lg:text-xl font-medium tracking-tight text-center",M.textContent=b,S.appendChild(M),y.appendChild(E),y.appendChild(S),I.appendChild(y),w.appendChild(I),w}!function(e){"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)}(()=>{const s=document.getElementById("home-infinite-gallery");if(!s)return;s.style.opacity="1";Array.from(s.querySelectorAll(".home-item")).forEach(e=>e.classList.add("home-item--revealed"));const a=window.homeLoaderConfig;if(a&&a.hasMore){const n=null!==s.closest('[data-scroll-direction="horizontal"]'),r=s.querySelector(".home-mobile"),i=n?Array.from(s.querySelectorAll(".home-track-h")):Array.from(s.querySelectorAll(".home-track"));let o=0;const l=new t({apiUrl:`${a.basePath}/api/home/gallery`,container:s,shownImageIds:a.shownImageIds,shownAlbumIds:a.shownAlbumIds,batchSize:20,renderImage:t=>{const s=e(t,a.basePath,n);if(r){const s=e(t,a.basePath,!1);s.className="home-cell",r.appendChild(s)}if(i.length>0){i[o%i.length].appendChild(s),o++}}});l.startBackgroundLoading();const c=document.getElementById("home-load-trigger");c&&l.observe(c)}})}();
